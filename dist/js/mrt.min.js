angular.module("MRT",["app-parameters","ui.bootstrap","ui.router","ngCookies","ngTable","ngAnimate","vr.directives.slider","ui.select","ngSanitize"]);
angular.module("app-parameters",[]).constant("env",{apiUrl:"http://192.168.0.7/market-attractiveness/mrt-api/web/app.php/api"});
"use strict";angular.module("MRT").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("index",{url:"/",templateUrl:"module/mrt/app/templates/index.html"}).state("dashboard",{url:"/dashboard",templateUrl:"module/mrt/app/templates/dashboard.html"}).state("geomodel",{url:"/geomodel",controller:"GeoModelCtrl",templateUrl:"module/mrt/geomodel/templates/geomodel-index.html"}).state("view-fund",{url:"/view-fund/:phoneId",controller:"ViewFundCtrl",templateUrl:"tpls/mrt/tpls/tpls/view-fund.html"}).state("tables",{url:"/tables",templateUrl:"tables.html"})}]);




function MasterCtrl(t,e){var o=992;t.getWidth=function(){return window.innerWidth},t.$watch(t.getWidth,function(g){t.toggle=g>=o?angular.isDefined(e.get("toggle"))&&0==e.get("toggle")?!1:!0:!1}),t.toggleSidebar=function(){t.toggle=!t.toggle,e.put("toggle",t.toggle)},window.onresize=function(){t.$apply()}}angular.module("MRT").controller("MasterCtrl",["$scope","$cookieStore",MasterCtrl]);
function searchSection(){var e={restrict:"AE",replace:!0,templateUrl:"module/mrt/authentication/templates/login.html"};return e}angular.module("MRT").directive("loginSection",searchSection);
function lineChart(){var e={restrict:"AE",replace:!0,link:function(e,t){var n;d3.json("../data/cumulativeLineData.json",function(e){nv.addGraph(function(){n=nv.models.cumulativeLineChart().x(function(e){return e[0]}).y(function(e){return e[1]/100}).color(d3.scale.category10().range()).useInteractiveGuideline(!0),n.xAxis.tickValues([10780308e5,11227824e5,11675412e5,12516912e5]).tickFormat(function(e){return d3.time.format("%x")(new Date(e))}),n.yAxis.tickFormat(d3.format(",.1%"));var a=d3.select(t[0]).append("svg");return console.log(a),a.datum(e).call(n),nv.utils.windowResize(n.update),n})})}};return e}angular.module("MRT").directive("lineChart",lineChart);
function pieChart(){var t={restrict:"AE",replace:!0,link:function(t,e){{var a={apples:[{name:"The Gambia",value:53245},{name:"Senegal",value:28479},{name:"Sierra Leone",value:19697},{name:"Nigeria",value:24037},{name:"Liberia",value:40245}]},r=300,n=300,l=Math.min(r,n)/2,c=(d3.scale.category20(),["#3498db","#2ecc71","#2c3e50","#8e44ad","#f39c12","#e74c3c"]),c=["#00BFF3","#EB5367","#FFCE54","#738F12","#2A2F36"],i=c[0],d=d3.scale.linear().domain([0,a.apples.length]).range([d3.rgb(i),d3.rgb("#c9e9f5")]),s=d3.layout.pie().value(function(t){return t.value}).sort(null),p=s(a.apples),o=d3.svg.arc().innerRadius(l-r/3).outerRadius(l-r/6),u=d3.select(e[0]).append("svg").attr("width",r).attr("height",n).append("g").attr("transform","translate("+r/2+","+n/2+")");u.selectAll("path").data(p).enter().append("path").attr("fill",function(t,e){return d(e)}).attr("d",o)}u.selectAll("text").data(p).enter().append("text").style("fill","#7f8c8d").attr("text-anchor","middle").attr("x",function(t){var e=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2;return t.cx=Math.cos(e)*(l-75),t.x=Math.cos(e)*(l-20)}).attr("y",function(t){var e=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2;return t.cy=Math.sin(e)*(l-75),t.y=Math.sin(e)*(l-20)}).text(function(t){return t.data.name}).each(function(t){var e=this.getBBox();t.sx=t.x-e.width/2-2,t.ox=t.x+e.width/2+2,t.sy=t.oy=t.y+5}),u.append("defs").append("marker").attr("id","circ").attr("markerWidth",6).attr("markerHeight",6).attr("refX",3).attr("refY",3).style("fill","#7f8c8d").append("circle").attr("cx",3).attr("cy",3).attr("r",3),u.selectAll("path.pointer").data(p).enter().append("path").attr("class","pointer").style("fill","none").style("stroke","#7f8c8d").attr("marker-end","url(#circ)").attr("d",function(t){return t.cx>=t.ox?"M"+t.sx+","+t.sy+"L"+t.ox+","+t.oy+" "+t.cx+","+t.cy:"M"+t.ox+","+t.oy+"L"+t.sx+","+t.sy+" "+t.cx+","+t.cy})}};return t}angular.module("MRT").directive("pieChart",pieChart);
function worldMap(){var t={restrict:"AE",replace:!0,scope:{data:"=chartData"},link:function(t,e){function a(t,e){m=d3.geo.mercator().translate([t/2,e/2]).scale(t/2/Math.PI),v=d3.geo.path().projection(m),h=d3.select(l).append("svg").attr("width",t).attr("height",e).call(y).on("click",s).append("g"),g=h.append("g")}function n(t,e,a){for(var n=.1,r=[];1>=n;)r.push("rgba("+t+", "+e+", "+a+", "+n+")"),n+=.1;return r}function r(t){h.append("path").datum(M).attr("class","graticule").attr("d",v),g.append("path").datum({type:"LineString",coordinates:[[-180,0],[-90,0],[0,0],[90,0],[180,0]]}).attr("class","equator").attr("d",v);var e=g.selectAll(".country").data(t);e.enter().insert("path").attr("class","country").attr("d",v).attr("id",function(t){return t.id}).attr("title",function(t){return t.properties.name}).attr("country",function(t){return t.properties.name.toUpperCase()}).style("fill",function(){return"#ccc"});var a=l.offsetLeft+20,n=l.offsetTop+10;e.on("mousemove",function(t){var e=d3.mouse(h.node()).map(function(t){return parseInt(t)});C.classed("hidden",!1).attr("style","left:"+(e[0]+a)+"px;top:"+(e[1]+n)+"px").html(t.properties.name)}).on("mouseout",function(){C.classed("hidden",!0)}),d3.csv(p,function(t,e){e.forEach(function(t){d(t.CapitalLongitude,t.CapitalLatitude,t.CapitalName);{var e=t.Percent;d3.rgb("#090")}d3.select("[country='"+t.CountryName.toUpperCase()+"']").style("fill",function(){return z(e)})})})}function o(){w=l.offsetWidth,x=w/2,d3.select("svg").remove(),a(w,x),r(f)}function c(){var t=d3.event.translate,e=d3.event.scale;zscale=e;var a=x/4;t[0]=Math.min(w/x*(e-1),Math.max(w*(1-e),t[0])),t[1]=Math.min(a*(e-1)+a*e,Math.max(x*(1-e)-a*e,t[1])),y.translate(t),g.attr("transform","translate("+t+")scale("+e+")"),d3.selectAll(".country").style("stroke-width",1.5/e)}function i(){window.clearTimeout(j),j=window.setTimeout(function(){o()},200)}function s(){var t=m.invert(d3.mouse(this));console.log(t)}function d(t,e,a){var n=g.append("g").attr("class","gpoint"),r=m([t,e])[0],o=m([t,e])[1];n.append("svg:circle").attr("cx",r).attr("cy",o).attr("class","point").attr("r",1.5),a.length>0&&n.append("text").attr("x",r+2).attr("y",o+2).attr("class","text").text(a)}var l=e[0],u="../data/world-topo-min.json",p="../data/country-capitals.csv";d3.select(window).on("resize",i);var f,m,v,h,g,y=d3.behavior.zoom().scaleExtent([1,9]).on("zoom",c),w=l.offsetWidth,x=w/4,M=d3.geo.graticule(),C=d3.select(l).append("div").attr("class","tooltip hidden");a(w,x),d3.json(u,function(t,e){var a=topojson.feature(e,e.objects.countries).features;f=a,r(f)});var j,b=n(243,156,18),b=n(243,156,18),z=d3.scale.linear().domain(d3.range(0,1,1/(b.length-1))).range(b)}};return t}angular.module("MRT").directive("worldMap",worldMap);
angular.module("MRT").factory("geoGroupService",["$http","env",function(r,e){var t=e.apiUrl,n={};return n.list=function(e){return r.get(t+"/geogroup/",{params:e})},n}]);
angular.module("MRT").controller("GeoModelCtrl",["$scope","$filter","geoModelService","geoGroupService",function(a,e,o,t){a.data={weight:10},a.response={},a.response.geogroups={data:[]},a.response.geoindicators={list:[]},a.data.values={},a.data.maxGeoScore=0,a.data.scoreMax=100,a.data.indicators=[],a.data.params={id:1,date:2013},a.predicate="-score",a.data.dates=[2013,2012,2011,2010],a.data.params.date=a.data.dates[0],a.getIndicatorValues=function(e,o){a.data.params.geogroup_id=o.id,a.getValues()},a.getValues=function(){o.getValues(a.data.params).success(function(e){a.data.values=e,a.setIndicators()}).error(function(e){a.status="Unable to load customer data: "+e.message})},o.getIndicators(a.data.params).success(function(e){a.response.geoindicators.list=e.indicators,a.setIndicators()}).error(function(e){a.status="Unable to load customer data: "+e.message}),t.list().success(function(e){a.response.geogroups.data=e.geogroups}).error(function(e){a.status="Unable to load groups data: "+e.message}),a.setIndicators=function(){a.indicatorChanged(),angular.forEach(a.response.geoindicators.list,function(a){a.max=0,a.maxScore=0})},a.indicatorChanged=function(e){a.data.maxGeoScore=0,"undefined"!=typeof e&&(e.max=0,e.maxScore=0)},a.getScore=function(o){var t=0,r=a.response.geoindicators.list.length*this.data.values.settings.max_weight;return angular.forEach(a.response.geoindicators.list,function(s){var i=e("filter")(o.indicators,{geography_id:o.id,geoindicator_id:s.id},!0);if(i.length){var n=s.weight/r*100;i[0].score=a.data.scoreMax/i[0].value*n,i[0].score>s.maxScore&&(s.max=i[0].value,s.maxScore=i[0].score),t+=i[0].score}}),o.score=t,o.score>a.data.maxGeoScore&&(a.data.maxGeoScore=o.score),t},a.getGeographyIndicator=function(a,o){var t=e("filter")(a.indicators,{geography_id:a.id,geoindicator_id:o.id},!0);return t.length?t[0]:{}}}]);
function GeoModelGeMatrix(){var e={restrict:"AE",replace:!0,templateUrl:"js/module/mrt/geomodel/templates/geomodel-ge-matrix.html"};return e}angular.module("MRT").directive("GeoModelGeMatrix",GeoModelGeMatrix);
function GeoModelMap(){var e={restrict:"AE",replace:!0,templateUrl:"js/module/mrt/geomodel/templates/geomodel-map.html"};return e}angular.module("MRT").directive("geoModelMap",GeoModelMap);
function geoModelTable(){var e={restrict:"AE",replace:!0,templateUrl:"js/module/mrt/geomodel/templates/geomodel-table.html"};return e}angular.module("MRT").directive("geoModelTable",geoModelTable);
function geoModelWeight(){var e={restrict:"AE",replace:!0,templateUrl:"js/module/mrt/geomodel/templates/geomodel-weight.html",link:function(){}};return e}angular.module("MRT").directive("geoModelWeight",geoModelWeight);
angular.module("MRT").factory("geoModelService",["$http","env",function(t,n){var e=n.apiUrl,r={};return r.getValues=function(n){return t.get(e+"/geomodel/values",{params:n})},r.getIndicators=function(n){return t.get(e+"/geomodel/indicators",{params:n})},r.getFundSectors=function(n){return t.get(e+"/fund/sectors",{params:{fund:n}})},r.getFundCountries=function(n){return t.get(e+"/fund/countries",{params:{fund:n}})},r.getFunds=function(){return t.get(e+"/fund/funds")},r.listCountries=function(){return t.get(e)},r.listSectors=function(){return t.get(e)},r.listFundTypes=function(){return t.get(e)},r.listFundcategories=function(){return t.get(e)},r}]);